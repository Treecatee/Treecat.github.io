{"title":"PHP操作MySQL数据库","date":"2019-02-24T02:32:17.000Z","thumbnail":"https://i.loli.net/2019/02/23/5c70e8131bb0c.jpg","slug":"PHP-MySQL","tags":["MySQL","PHP语言"],"categories":["PHP"],"updated":"2019-02-27T17:13:19.685Z","content":"<p>😁<br><a id=\"more\"></a><br>&ensp;<br>&ensp;</p>\n<center><font color=\"#00B2EE\" face=\"Comic sans MS\" size=\"5\"><strong>PHP操作MySQL数据库</strong></font></center>\n\n\n\n<p>&emsp;<br>&emsp;</p>\n<h3 id=\"一-数据库连接步骤\"><a href=\"#一-数据库连接步骤\" class=\"headerlink\" title=\"一. 数据库连接步骤\"></a><font color=\"#FF6347\" face=\"Comic sans MS\">一. 数据库连接步骤</font></h3><p>将数据库连接整理成了最重要的<font color=\"#FF7F00\"><strong>8个步骤</strong></font>，我戏称它为：“数据库连接天龙八步”。😊  (。・∀・)ノ</p>\n<p>&emsp;</p>\n<h4 id=\"第一步-连接数据库服务器\"><a href=\"#第一步-连接数据库服务器\" class=\"headerlink\" title=\"第一步:  连接数据库服务器\"></a><font color=\"#3CB371\" face=\"Comic sans MS\">第一步:  连接数据库服务器</font></h4><font color=\"#00B2EE\">[<a href=\"http://www.w3school.com.cn/php/func_mysql_connect.asp\" target=\"_blank\" rel=\"noopener\">PHP mysql_connect() 函数</a>]</font>\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">函数</td>\n<td style=\"text-align:left\">mysqli_connect()</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">函数原型</td>\n<td style=\"text-align:left\">mysql_connect(server,user,pwd,newlink,clientflag)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">功能</td>\n<td style=\"text-align:left\">连接到mysql数据库服务器</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">返回值</td>\n<td style=\"text-align:left\">如果成功，则返回一个 MySQL 连接标识，失败则返回 FALSE。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数1</td>\n<td style=\"text-align:left\">主机</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数2</td>\n<td style=\"text-align:left\">数据库服务器登陆名</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数3</td>\n<td style=\"text-align:left\">密码</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数4</td>\n<td style=\"text-align:left\">数据库的名称</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数5</td>\n<td style=\"text-align:left\">数据库服务器端口不填默认3306</td>\n</tr>\n</tbody>\n</table></div></div>\n<blockquote>\n<font color=\"#FF7F00\"><strong>对于参数4，数据库名称在此步已填并择，不需要执行第三步。</strong></font>\n</blockquote>\n<p>&emsp;</p>\n<h4 id=\"第二步-判断错误\"><a href=\"#第二步-判断错误\" class=\"headerlink\" title=\"第二步:  判断错误\"></a><font color=\"#3CB371\" face=\"Comic sans MS\">第二步:  判断错误</font></h4><font color=\"#00B2EE\">[<a href=\"http://www.w3school.com.cn/php/func_mysql_errno.asp\" target=\"_blank\" rel=\"noopener\">PHP mysqli_errno() 函数</a>]</font>\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">函数</td>\n<td style=\"text-align:left\">mysqli_errno(connection)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">功能/返回值</td>\n<td style=\"text-align:left\">返回连接错误号，无错误返回0</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数1</td>\n<td style=\"text-align:left\">传入mysqli_connect()返回的资源可选。规定 SQL 连接标识符。如果未规定，则使用上一个<br>打开的连接。</td>\n</tr>\n</tbody>\n</table></div></div>\n<p>&emsp;</p>\n<font color=\"#FF7F00\"><strong>如果mysqli_errno()函数返回错误号，则用mysqli_error()显示文本错误信息。</strong></font>&emsp;<font color=\"#00B2EE\">[<a href=\"http://www.w3school.com.cn/php/func_mysql_error.asp\" target=\"_blank\" rel=\"noopener\">PHP mysql_error() 函数</a>]</font>\n\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">函数</td>\n<td style=\"text-align:left\">mysqli_error(connection)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">功能/返回值</td>\n<td style=\"text-align:left\">返回连接错误字符串，如果没有出错则返回 ‘’（空字符串）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数1</td>\n<td style=\"text-align:left\">传入mysqli_connect返回的资源</td>\n</tr>\n</tbody>\n</table></div></div>\n<p>&emsp;</p>\n<h4 id=\"第三步-选择数据库\"><a href=\"#第三步-选择数据库\" class=\"headerlink\" title=\"第三步:  选择数据库\"></a><font color=\"#3CB371\" face=\"Comic sans MS\">第三步:  选择数据库</font></h4><font color=\"#00B2EE\">[<a href=\"http://www.w3school.com.cn/php/func_mysql_select_db.asp\" target=\"_blank\" rel=\"noopener\">PHP mysqli_select_db() 函数</a>]</font>\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">函数</td>\n<td style=\"text-align:left\">mysql_selecti_db(connection,database)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">返回值</td>\n<td style=\"text-align:left\">如果成功，则该函数返回 true。如果失败，则返回 false。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">功能</td>\n<td style=\"text-align:left\">选择本连接中的<strong>数据库</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数1</td>\n<td style=\"text-align:left\">传入mysqli_connect返回的资源</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数2</td>\n<td style=\"text-align:left\">需要连接的数据库名</td>\n</tr>\n</tbody>\n</table></div></div>\n<blockquote>\n<font color=\"#FF7F00\"><strong>若在第一步已填数据库，不需要更换成其他数据库，则不需要执行第三步。</strong></font>\n</blockquote>\n<p>&emsp;</p>\n<h4 id=\"第四步-设置字符集\"><a href=\"#第四步-设置字符集\" class=\"headerlink\" title=\"第四步:  设置字符集\"></a><font color=\"#3CB371\" face=\"Comic sans MS\">第四步:  设置字符集</font></h4><font color=\"#00B2EE\">[<a href=\"http://www.runoob.com/php/func-mysqli-set-charset.html\" target=\"_blank\" rel=\"noopener\">PHP mysqli_set_charset 函数</a>]</font>\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">函数</td>\n<td style=\"text-align:left\">mysqli_set_charset(connection,charset)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">功能</td>\n<td style=\"text-align:left\">设置与mysql服力器连接，结果，校验字符集</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">返回值</td>\n<td style=\"text-align:left\">无返回值</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数1</td>\n<td style=\"text-align:left\">传入mysqli_connect返回的资源</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数2</td>\n<td style=\"text-align:left\">字符集类型</td>\n</tr>\n</tbody>\n</table></div></div>\n<p>&emsp;</p>\n<h4 id=\"第五步-准备SQL语句\"><a href=\"#第五步-准备SQL语句\" class=\"headerlink\" title=\"第五步:  准备SQL语句\"></a><font color=\"#3CB371\" face=\"Comic sans MS\">第五步:  准备SQL语句</font></h4><font color=\"#FF7F00\"><strong>其实就是一个SQL语句的字符串，用于对MySQL数据库的操作。这一步很重要！</strong></font> \n\n<p>&emsp;<br>例如：</p>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token delimiter\">&lt;?php</span>\n<span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"insert into user(username,password) values('$username','$password')\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$con</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysql_connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"peter\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"abc123\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$con</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Could not connect: '</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">mysql_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">// some code</span>\n<span class=\"token delimiter\">?></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<ol>\n<li>我们通常要把变量赋值在SQL语句中使用。可是变量或者SQL语句出错了，非常不好排查。</li>\n<li>我们根据实际工作经验增加了这一步。</li>\n<li>如果在执行此步的时候报错了，我们可以把SQL语句打印出来，粘贴到phpMyAdmin或者相关工具中。</li>\n<li>排错时，如果执行成功就说明不是SQL语句的问题。如果执行失败，请仔细检查SQL语句。</li>\n</ol>\n</blockquote>\n<p>&emsp;</p>\n<h4 id=\"第六步-发送SQL语句\"><a href=\"#第六步-发送SQL语句\" class=\"headerlink\" title=\"第六步:  发送SQL语句\"></a><font color=\"#3CB371\" face=\"Comic sans MS\">第六步:  发送SQL语句</font></h4><font color=\"#00B2EE\">[<a href=\"http://www.w3school.com.cn/php/func_mysql_query.asp\" target=\"_blank\" rel=\"noopener\">PHP mysqli_query() 函数</a>]</font>\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">功能</td>\n<td style=\"text-align:left\">发送SQL语句,执行一条 MySQL 查询。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">返回值</td>\n<td style=\"text-align:left\">mysqli_query() 仅对 SELECT，SHOW，EXPLAIN 或 DESCRIBE 语句<strong>返回一个资源标识符</strong>，<br>如果查询执行不正确则返回 FALSE。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数1</td>\n<td style=\"text-align:left\">传入mysqli_connect返回的资源</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数2</td>\n<td style=\"text-align:left\">传入发送的SQL语句。注意：查询字符串不应以分号结束。</td>\n</tr>\n</tbody>\n</table></div></div>\n<blockquote>\n<ol>\n<li>SQL语句准备完成，需要通过mysqli_query将SQL语句发送给MySQL服务器。</li>\n<li>MySQL服务器会执行发送过来的SQL语句进行执行。</li>\n</ol>\n</blockquote>\n<p>&emsp;</p>\n<h4 id=\"第七步-判断是否执行正常或者遍历数据\"><a href=\"#第七步-判断是否执行正常或者遍历数据\" class=\"headerlink\" title=\"第七步:  判断是否执行正常或者遍历数据\"></a><font color=\"#3CB371\" face=\"Comic sans MS\">第七步:  判断是否执行正常或者遍历数据</font></h4><font color=\"#00B2EE\">[<a href=\"http://www.w3school.com.cn/php/func_mysql_fetch_array.asp\" target=\"_blank\" rel=\"noopener\">PHP mysqli_fetch_array() 函数</a>]</font><br>读取第6步中，发送的是select类别的语句，<font color=\"#FF7F00\"><strong>通常需要将结果以数组形式输出显示出来</strong></font>。就需要用到遍历显示数据的函数。<br><br><font color=\"red\"></font>\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">函数</td>\n<td style=\"text-align:left\">mysqli_fetch_array(data,array_type)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">功能</td>\n<td style=\"text-align:left\">得到result结果集中的数据，返回数组进行遍历</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数1</td>\n<td style=\"text-align:left\">可选。规定要使用的数据指针。该数据指针是 mysqli_query() 函数产生的结果。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数2</td>\n<td style=\"text-align:left\">可选。规定返回哪种结果。可能的值：<br>MYSQL_ASSOC - 关联数组<br>MYSQL_NUM - 数字数组<br>MYSQL_BOTH - 默认。同时产生关联和数字数组</td>\n</tr>\n</tbody>\n</table></div></div>\n<p>&emsp;<br>下面举例几个常用的<strong>将mysqli_query()查询得到的字符串处理成数组的函数</strong>…….</p>\n<font color=\"red\"></font>\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">函数</th>\n<th style=\"text-align:left\">功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">mysqli_fetch_assoc(data)</td>\n<td style=\"text-align:left\">返回根据从结果集取得的行生成的<strong>关联数组</strong>，如果没有更多行，则返回 false</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">mysqli_fetch_row(data)</td>\n<td style=\"text-align:left\">返回根据从结果集取得的行生成的<strong>索引数组</strong>，如果没有更多行，则返回 false</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">mysqli_fetch_object(data)</td>\n<td style=\"text-align:left\">从结果集（记录集）中取得一行作为对象。<br>若成功的话，本函数从 mysql_query() 获得一行，并返回一个对象。如果失败<br>或没有更多的行，则返回 false。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">mysqli_num_rows(data)</td>\n<td style=\"text-align:left\">返回结果集中行的数目。此命令仅对 SELECT 语句有效。<br>要取得被 INSERT，UPDATE 或者 DELETE 查询所影响到的行的数目，<br>用 mysqli_affected_rows()。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">mysqli_fetch_field</td>\n<td style=\"text-align:left\">从结果集中取得列信息并作为对象返回。</td>\n</tr>\n</tbody>\n</table></div></div>\n<p>&emsp;</p>\n<h4 id=\"第八步-关闭数据库\"><a href=\"#第八步-关闭数据库\" class=\"headerlink\" title=\"第八步:  关闭数据库\"></a><font color=\"#3CB371\" face=\"Comic sans MS\">第八步:  关闭数据库</font></h4><font color=\"#00B2EE\">[<a href=\"http://www.w3school.com.cn/php/func_mysql_close.asp\" target=\"_blank\" rel=\"noopener\">PHP mysql_close() 函数</a>]</font>\n\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">函数</td>\n<td style=\"text-align:left\">mysqli_close(link_identifier)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">功能</td>\n<td style=\"text-align:left\">关闭数据库连接</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">返回值</td>\n<td style=\"text-align:left\">如果成功则返回 true，失败则返回 false。</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数1</td>\n<td style=\"text-align:left\">传入mysqli_connect返回的资源</td>\n</tr>\n</tbody>\n</table></div></div>\n<p>&emsp;</p>\n<font color=\"red\" face=\"Comic sans MS\"><strong>其他：显示服务器信息函数</strong></font> \n\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">函数</td>\n<td style=\"text-align:left\">mysqli_get_server_info</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">功能</td>\n<td style=\"text-align:left\">返回服务器信息</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数1</td>\n<td style=\"text-align:left\">传入mysqli_connect返回的资源</td>\n</tr>\n</tbody>\n</table></div></div>\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">函数</td>\n<td style=\"text-align:left\">mysqli_get_server_version</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">功能</td>\n<td style=\"text-align:left\">返回服务器版本</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">参数1</td>\n<td style=\"text-align:left\">传入mysqli_connect返回的资源</td>\n</tr>\n</tbody>\n</table></div></div>\n<blockquote>\n<p><font color=\"#FF7F00\"><strong>注意：</strong></font><br>mysqli只学过程化的方法即可。在面向对象阶段实际工作中完全抛弃了mysqli的对象用法，而是使用的是PDO对象连接数据库的方式。</p>\n</blockquote>\n<p>&emsp;<br>&emsp;</p>\n<h3 id=\"二-通过步骤做一个用户注册实例\"><a href=\"#二-通过步骤做一个用户注册实例\" class=\"headerlink\" title=\"二. 通过步骤做一个用户注册实例\"></a><font color=\"#FF6347\" face=\"Comic sans MS\">二. 通过步骤做一个用户注册实例</font></h3><blockquote>\n<p><font color=\"#FF7F00\"><strong>我们做一个最简单的注册页面。注册页面中有三个参数：</strong></font></p>\n<ol>\n<li>用户名</li>\n<li>密码</li>\n<li>重复密码</li>\n</ol>\n<ul>\n<li>用户写好三个参数后，点击提交的时候向<code>connect.php</code>页面中传入POST记录。</li>\n<li>我们可以把<code>POST记录</code>处理后写入到MySQL数据库中，即完成了用户注。</li>\n</ul>\n</blockquote>\n<blockquote>\n<p><font color=\"#FF7F00\"><strong>本例用到的两个文件：</strong></font></p>\n<ol>\n<li><code>index.php</code>：表单页面；</li>\n<li><code>connect.php</code>：处理表单的页面。</li>\n</ol>\n</blockquote>\n<p>&emsp;</p>\n<font color=\"#00B2EE\" face=\"Comic sans MS\"><strong>一、 判断重复密码：</strong></font>\n\n<blockquote>\n<p>1.<strong>由于有重复密码，</strong><font color=\"#FF7F00\"><strong>如果用户两次输入的密码不一致也就是有没有进行下一步的任何意义。</strong></font><br>2.<font color=\"#FF7F00\"><strong>在网页中很多地方还是使用到了重复密码。</strong></font><strong>因为，害怕的是用户产生手误。将密码填写出错。</strong><br>3.<font color=\"#FF7F00\"><strong>用户在输入密码的时候可能在左右两边多打两个空格。因此，我们会使用trim将密码和重复密码的两边去掉空格。</strong></font></p>\n</blockquote>\n<p>&emsp;<br>代码如下：</p>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'repassword'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两次密码不一致,请返回上一页'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>&emsp;</p>\n<font color=\"#00B2EE\" face=\"Comic sans MS\"><strong>二、 准备好写入的数据：</strong></font><br>我们需要把用户的<strong>输入数据</strong>和<strong>隐藏的数据</strong>都写入到数据库。<br><br><font color=\"red\"><strong>可见数据有：</strong></font>\n\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">变量</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">$_POST[‘username’]</td>\n<td style=\"text-align:left\">用户名</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">$_POST[‘password’]</td>\n<td style=\"text-align:left\">密码</td>\n</tr>\n</tbody>\n</table></div></div>\n<blockquote>\n<ol>\n<li>我们需要把用户名去掉两边的空格，这样避免输入不必要的这些信息。</li>\n<li>在mysql这一章节我们讲过，用户的密码不要让包括公司内部人员可见。保证密码是不可逆向的。在初级阶段大家学习一下MD5即可。以后我们再教大家其他的加密方式。</li>\n</ol>\n</blockquote>\n<font color=\"red\"><strong>不可见数据有：</strong></font>\n\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">变量</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">$time</td>\n<td style=\"text-align:left\">用户的注册时间</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">$_SERVER[‘REMOTE_ADDR’]</td>\n<td style=\"text-align:left\">用户的注册IP</td>\n</tr>\n</tbody>\n</table></div></div>\n<blockquote>\n<ol>\n<li>time返回的unix时间戳</li>\n<li>REMOTE_ADDR返回的是IP地址，我们可以用ip2long将其转为整型存储。</li>\n</ol>\n</blockquote>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token variable\">$username</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'username'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$password</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$time</span> <span class=\"token operator\">=</span> <span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$ip</span> <span class=\"token operator\">=</span> <span class=\"token function\">ip2long</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span><span class=\"token string\">'REMOTE_ADDR'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>&emsp;</p>\n<font color=\"#00B2EE\" face=\"Comic sans MS\"><strong>三、连接数据库、判断错误、选择库和字符集：</strong></font>\n\n\n<blockquote>\n<ol>\n<li>我们使用mysqli_connect连接到数据库服务器。</li>\n<li>如果有错误，使用mysqli_errno得到错误号</li>\n<li>如何时存在错误mysqli_error打印出所有的错误，并且退出程序执行</li>\n<li>选择数据库并且设置字符集为utf8.</li>\n</ol>\n</blockquote>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token comment\" spellcheck=\"true\">//连接数据库</span>\n<span class=\"token variable\">$conn</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'liwenkaihaha'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//如果有错误，存在错误号</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">mysqli_errno</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    exit<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\" spellcheck=\"true\">//选择数据库</span>\n<span class=\"token function\">mysqli_select_db</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">,</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//选择字符集</span>\n<span class=\"token function\">mysqli_set_charset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">,</span><span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>&emsp;</p>\n<font color=\"#00B2EE\" face=\"Comic sans MS\"><strong>四、组合SQL语句：</strong></font><br>我们需要把得到的信息写入到数据库里面去，用户名、密码、创建时间、IP我们都得到了。<br><br>将对应的变量插入到SQL语句中即可。组合出来的SQL语句如下：<br><font color=\"#00B2EE\"></font>\n\n\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"insert into user(username,password,createtime,createip) values('\"</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$username</span> <span class=\"token punctuation\">.</span> \"'\n<span class=\"token punctuation\">,</span><span class=\"token string\">'\" . $password . \"'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'\" . $time . \"'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'\" . $ip . \"'</span><span class=\"token punctuation\">)</span>\"<span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>&emsp;<br>而我们的创建表的语句如下：</p>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token constant\">CREATE</span> <span class=\"token constant\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token constant\">NOT</span> <span class=\"token constant\">EXISTS</span> <span class=\"token function\">user</span> <span class=\"token punctuation\">(</span>\nid <span class=\"token function\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">NOT</span> <span class=\"token keyword\">NULL</span><span class=\"token punctuation\">,</span>\nusername <span class=\"token function\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">NOT</span> <span class=\"token keyword\">NULL</span><span class=\"token punctuation\">,</span>\npassword <span class=\"token function\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">NOT</span> <span class=\"token keyword\">NULL</span><span class=\"token punctuation\">,</span>\ncreatetime <span class=\"token function\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">NOT</span> <span class=\"token keyword\">NULL</span><span class=\"token punctuation\">,</span>\ncreateip <span class=\"token function\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">NULL</span>\n<span class=\"token punctuation\">)</span> <span class=\"token constant\">ENGINE</span><span class=\"token operator\">=</span>InnoDB <span class=\"token keyword\">DEFAULT</span> <span class=\"token constant\">CHARSET</span><span class=\"token operator\">=</span>utf8<span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>&emsp;<br>表的格式（字段对应说明）：</p>\n<font color=\"#00B2EE\"></font>\n\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">id</th>\n<th style=\"text-align:center\">username</th>\n<th style=\"text-align:center\">password</th>\n<th style=\"text-align:center\">createtime</th>\n<th style=\"text-align:center\">createip</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">用户编号</td>\n<td style=\"text-align:center\">用户名</td>\n<td style=\"text-align:center\">密码</td>\n<td style=\"text-align:center\">创建时间</td>\n<td style=\"text-align:center\">创建IP</td>\n</tr>\n</tbody>\n</table></div></div>\n<p>&emsp;</p>\n<font color=\"#00B2EE\" face=\"Comic sans MS\"><strong>五、发送语句，判断状态：</strong></font>\n\n\n<blockquote>\n<p>mysqli_query我们在上面说过，需要传入两个参数：</p>\n<ol>\n<li>连接的资源，在这里对应的变量是$conn。</li>\n<li>发送的SQL语句。在上面已经准备好了$sql。</li>\n</ol>\n</blockquote>\n<blockquote>\n<p>SQL语句可以通过mysqli_query发送给MySQL服务器。发送成功$result则为true。否则为false。<br>成功的话，我们就可以提示用户注册成功啦。<br>有些情况下，可能还需要使用到<strong>mysqli_insert_id()</strong>。功能是获取上面通过insert插入数据的id并返回这个id。<br>mysqli_insert_id应用场景：新加的一个行的数据。我们需要得到自动增长的ID值，将这个ID值插入到另外一个表里面去时。就需要用到这个函数。</p>\n</blockquote>\n<p>&emsp;</p>\n<p><code>mysqli_insert_id()</code>使用举例：</p>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$sql</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$result</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string\">'注册成功'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string\">'注册失败'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">echo</span> <span class=\"token string\">'当前用户插入的ID为'</span><span class=\"token punctuation\">.</span><span class=\"token function\">mysqli_insert_id</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>&emsp;</p>\n<font color=\"#00B2EE\" face=\"Comic sans MS\"><strong>六、关闭数据库连接：</strong></font>\n\n<p>将资源变量传到到mysqli_close这个函数里面即可。</p>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>&emsp;<br>&emsp;<br>&emsp;<br>先建立test数据库、user数据表。数据表建立语句：</p>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token constant\">CREATE</span> <span class=\"token constant\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token constant\">NOT</span> <span class=\"token constant\">EXISTS</span> <span class=\"token function\">user</span> <span class=\"token punctuation\">(</span>id <span class=\"token function\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">PRIMARY</span> <span class=\"token constant\">KEY</span> <span class=\"token constant\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>username <span class=\"token function\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">NOT</span> <span class=\"token keyword\">NULL</span><span class=\"token punctuation\">,</span>password <span class=\"token function\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">NOT</span> <span class=\"token keyword\">NULL</span><span class=\"token punctuation\">,</span>createtime <span class=\"token function\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">NOT</span> <span class=\"token keyword\">NULL</span><span class=\"token punctuation\">,</span>createip <span class=\"token function\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">NULL</span><span class=\"token punctuation\">)</span> <span class=\"token constant\">ENGINE</span><span class=\"token operator\">=</span>InnoDB <span class=\"token keyword\">DEFAULT</span> <span class=\"token constant\">CHARSET</span><span class=\"token operator\">=</span>utf8<span class=\"token punctuation\">;</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>&emsp;</p>\n<font color=\"red\"><strong>1. <code>index.php</code>表单页面：</strong></font>\n\n\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>connect.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></span>\n    用户名：<span class=\"token markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></span><span class=\"token markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span></span>\n    密码：<span class=\"token markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></span><span class=\"token markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span></span>\n    重复密码：<span class=\"token markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>repassword<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></span><span class=\"token markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span></span>\n    <span class=\"token markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>提交<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></span>\n<span class=\"token markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>&emsp;<br>&emsp;</p>\n<font color=\"red\"><strong>2. <code>connect.php</code>页面完整代码：</strong></font>\n\n\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token delimiter\">&lt;?php</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'repassword'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两次密码不一致,请返回上一页'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$username</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'username'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$password</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$time</span> <span class=\"token operator\">=</span> <span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$ip</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span><span class=\"token string\">'REMOTE_ADDR'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$conn</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'root'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//echo $username.\"/\".$password.\"/\".$time.\"/\".$ip;</span>\n<span class=\"token comment\" spellcheck=\"true\">//如果有错误，存在错误号</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">mysqli_errno</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n   <span class=\"token keyword\">echo</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   exit<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">mysqli_select_db</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">mysqli_set_charset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"insert into user(username,password,createtime,createip) values ('$username','$password','$time','$ip')\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$sql</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">echo</span> <span class=\"token string\">'成功'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">echo</span> <span class=\"token string\">'失败'</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">var_dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"错误为：\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">var_dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"返回值：\"</span><span class=\"token punctuation\">.</span><span class=\"token variable\">$result</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">echo</span> <span class=\"token string\">'当前用户插入的ID为'</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">mysqli_insert_id</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter\">?></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>&emsp;<br>&emsp;</p>\n<h3 id=\"三-通过步骤做一个列表显示实例\"><a href=\"#三-通过步骤做一个列表显示实例\" class=\"headerlink\" title=\"三. 通过步骤做一个列表显示实例\"></a><font color=\"#FF6347\" face=\"Comic sans MS\">三. 通过步骤做一个列表显示实例</font></h3><font color=\"#00B2EE\">[<a href=\"http://www.php.cn/code/1262.html\" target=\"_blank\" rel=\"noopener\">教程</a>]</font><br><font color=\"#00B2EE\">[<a href=\"http://www.php.cn/code/4977.html\" target=\"_blank\" rel=\"noopener\">视频</a>]</font>\n\n\n<p>&emsp;<br>&emsp;</p>\n<h3 id=\"四-通过步骤操作之把用户做个分页\"><a href=\"#四-通过步骤操作之把用户做个分页\" class=\"headerlink\" title=\"四. 通过步骤操作之把用户做个分页\"></a><font color=\"#FF6347\" face=\"Comic sans MS\">四. 通过步骤操作之把用户做个分页</font></h3><font color=\"#00B2EE\">[<a href=\"http://www.php.cn/code/1273.html\" target=\"_blank\" rel=\"noopener\">教程</a>]</font><br><font color=\"#00B2EE\">[<a href=\"http://www.php.cn/code/4978.html\" target=\"_blank\" rel=\"noopener\">视频</a>]</font>\n\n\n<p>&emsp;<br>&emsp;</p>\n<h3 id=\"五-批量和指定删除用户\"><a href=\"#五-批量和指定删除用户\" class=\"headerlink\" title=\"五.  批量和指定删除用户\"></a><font color=\"#FF6347\" face=\"Comic sans MS\">五.  批量和指定删除用户</font></h3><p>上面已经学过了通过步骤做一个列表显示，在删除前，<font color=\"#FF7F00\"><strong>有单行删除数据和删除多行数据</strong></font>。</p>\n<p>&emsp;</p>\n<h4 id=\"5-1-判断是单选还是多选删除\"><a href=\"#5-1-判断是单选还是多选删除\" class=\"headerlink\" title=\"5.1 判断是单选还是多选删除\"></a><font color=\"#3CB371\" face=\"Comic sans MS\">5.1 判断是单选还是多选删除</font></h4><blockquote>\n<ol>\n<li><font color=\"#FF7F00\"><strong>单行是通过get传参的方式</strong></font>向delete.php文件中写上对应的ID。</li>\n<li>而<font color=\"#FF7F00\"><strong>多个删除是通过POST的方式</strong></font>向delete.php页面中传递对应的ID。</li>\n<li>如果这两个都不符合的话，那我们可以视为数据不合法。</li>\n</ol>\n</blockquote>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_numeric</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>int<span class=\"token punctuation\">)</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string\">'数据不合法'</span><span class=\"token punctuation\">;</span>\n    exit<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>&emsp;</p>\n<h4 id=\"5-2-组合SQL语句\"><a href=\"#5-2-组合SQL语句\" class=\"headerlink\" title=\"5.2 组合SQL语句\"></a><font color=\"#3CB371\" face=\"Comic sans MS\">5.2 组合SQL语句</font></h4><blockquote>\n<ol>\n<li>MySQL这一章讲解过<font color=\"#FF7F00\"><strong>删除时可以使用到in的子语句</strong></font>。</li>\n<li>同样在这里，我们就可以用in的子语句来达到效果。</li>\n<li><font color=\"#FF7F00\"><strong>join函数将多选删除传过来的id变为了3,4,5的格式</strong></font>，最终多选删除的SQL语句执行出来的效果就是：</li>\n</ol>\n</blockquote>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\">delete from user where id <span class=\"token function\">in</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>&emsp;<br>而单选删除的语句效果就是：</p>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\">delete from user where id <span class=\"token function\">in</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>&emsp;<br>这样我们就实现了单选和多选自适应效果：</p>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"delete from user where id in($id)\"</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>&emsp;<br>最终配套而成的整体代码演示如下：</p>\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token delimiter\">&lt;?php</span>\n\n<span class=\"token keyword\">include</span> <span class=\"token string\">'connection.php'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n   <span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_numeric</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n   <span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>int<span class=\"token punctuation\">)</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">echo</span> <span class=\"token string\">'数据不合法'</span><span class=\"token punctuation\">;</span>\n   exit<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"delete from user where id in($id)\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$conn</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$sql</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">echo</span> <span class=\"token string\">'删除成功'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">echo</span> <span class=\"token string\">'删除失败'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token delimiter\">?></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>&emsp;<br>&emsp;</p>\n<h3 id=\"六-通过步骤修改用户信息\"><a href=\"#六-通过步骤修改用户信息\" class=\"headerlink\" title=\"六. 通过步骤修改用户信息\"></a><font color=\"#FF6347\" face=\"Comic sans MS\">六. 通过步骤修改用户信息</font></h3><p>内容有点多，等哪天想起来了或者心情好了再写吧…..(✿◡‿◡)</p>\n<font color=\"#00B2EE\">[<a href=\"http://www.php.cn/code/1277.html\" target=\"_blank\" rel=\"noopener\">教程</a>]</font><br><font color=\"#00B2EE\">[<a href=\"http://www.php.cn/code/4980.html\" target=\"_blank\" rel=\"noopener\">视频</a>]</font>\n\n\n<p>&emsp;<br>&emsp;</p>\n<h3 id=\"七-数据显示乱码终极解决办法\"><a href=\"#七-数据显示乱码终极解决办法\" class=\"headerlink\" title=\"七. 数据显示乱码终极解决办法\"></a><font color=\"#FF6347\" face=\"Comic sans MS\">七. 数据显示乱码终极解决办法</font></h3><p>解决乱码问题的核心思想，就是：<font color=\"#FF7F00\"><strong>一定要多个不同的文件系统中一定要统一编码</strong></font>。</p>\n<p>&emsp;<br>总结成了9个要点来彻底解决连接后乱码的问题。</p>\n<blockquote>\n<ol>\n<li><font color=\"#00B2EE\"><strong>html编码与MySQL编码一致</strong></font></li>\n<li><font color=\"#00B2EE\"><strong>PHP编码与MySQL编码一致</strong></font></li>\n<li><font color=\"#00B2EE\"><strong>若有header头发送字符集，请与数据库一样</strong></font></li>\n<li><font color=\"#00B2EE\"><strong>&lt;meta http-equiv=“Content-Type”content=“text/html; charset=utf-8” /&gt;要和页面的文字编码一致</strong></font></li>\n<li><font color=\"#00B2EE\"><strong>数据库建库的字符集要统一</strong></font></li>\n<li><font color=\"#00B2EE\"><strong>表的字符集要统一</strong></font></li>\n<li><font color=\"#00B2EE\"><strong>列的字符集要统一(表设了,列就默认写表的)</strong></font></li>\n<li><font color=\"#00B2EE\"><strong>连接,校验的字符集要统一</strong></font></li>\n<li><font color=\"#00B2EE\"><strong>结果集的字符集要统一</strong></font>\n</li>\n</ol>\n</blockquote>\n<p>&emsp;<br>&emsp;<br>&emsp;</p>\n<font color=\"#FF7F00\"><strong>一、 文件编码</strong></font><br>html和PHP文件的编码，示例中：拿notepad++来演示。将PHP和html都要设为这种字符集。<br>一定要设置为utf-8无BOM格式。<br><br><img src=\"https://i.loli.net/2019/02/24/5c72764c43d27.png\" alt=\"1\"><br><br>&emsp;<br><font color=\"#FF7F00\"><strong>二、 header头编码</strong></font><br>如果php中有header头，一定要是<strong>utf-8</strong>的<br><font color=\"red\"></font>\n\n\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content-type:text/html;charset=utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>&emsp;</p>\n<font color=\"#FF7F00\"><strong>三、网页头文件编码</strong></font><br>如果html文件编码是utf-8的也要设置为一置<br><font color=\"red\"></font>\n\n\n<pre class=\"line-numbers language-php\"><code class=\"language-php\"><span class=\"token markup\">&lt;meta http-equiv=“Content-Type”content=“text/html; charset=utf-8” /></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>&emsp;</p>\n<font color=\"#FF7F00\"><strong>四、创建数据库的编码</strong></font>\n\n<div class=\"article-img\"><p><img src=\"https://i.loli.net/2019/02/24/5c72789c325a2.png\" alt=\"2\"></p></div>\n<p>&emsp;</p>\n<font color=\"#FF7F00\"><strong>五、表和列创建的时候表为utf-8</strong></font>\n\n<div class=\"article-img\"><p><img src=\"https://i.loli.net/2019/02/24/5c7278e24b5ad.png\" alt=\"3.png\"></p></div>\n<p>&emsp;</p>\n<font color=\"#FF7F00\"><strong>六、连接，结果、校验字符集设置</strong></font>\n\n\n<blockquote>\n<font color=\"#00B2EE\"><strong>1.通过mysqli_set_charset(‘utf8’)来MySQL连接、结果和校验的字符集设置。<br>2.注：数据库的字符集声明和文件中的略有不同。</strong></font><font color=\"red\"><strong>utf8为mysql数据库的，utf-8为文件中使用的。</strong></font></blockquote>\n","prev":{"title":"PHP-会话管理和控制","slug":"PHP-SessionManagement"},"next":{"title":"MySQL入门","slug":"MySQL-Primer"},"link":"Treecatee.gitgub.io/post/PHP-MySQL/","toc":[{"title":"<font color=\"#FF6347\" face=\"Comic sans MS\">一. 数据库连接步骤</font>","id":"一-数据库连接步骤","index":"1","children":[{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">第一步:  连接数据库服务器</font>","id":"第一步-连接数据库服务器","index":"1.1"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">第二步:  判断错误</font>","id":"第二步-判断错误","index":"1.2"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">第三步:  选择数据库</font>","id":"第三步-选择数据库","index":"1.3"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">第四步:  设置字符集</font>","id":"第四步-设置字符集","index":"1.4"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">第五步:  准备SQL语句</font>","id":"第五步-准备SQL语句","index":"1.5"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">第六步:  发送SQL语句</font>","id":"第六步-发送SQL语句","index":"1.6"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">第七步:  判断是否执行正常或者遍历数据</font>","id":"第七步-判断是否执行正常或者遍历数据","index":"1.7"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">第八步:  关闭数据库</font>","id":"第八步-关闭数据库","index":"1.8"}]},{"title":"<font color=\"#FF6347\" face=\"Comic sans MS\">二. 通过步骤做一个用户注册实例</font>","id":"二-通过步骤做一个用户注册实例","index":"2"},{"title":"<font color=\"#FF6347\" face=\"Comic sans MS\">三. 通过步骤做一个列表显示实例</font>","id":"三-通过步骤做一个列表显示实例","index":"3"},{"title":"<font color=\"#FF6347\" face=\"Comic sans MS\">四. 通过步骤操作之把用户做个分页</font>","id":"四-通过步骤操作之把用户做个分页","index":"4"},{"title":"<font color=\"#FF6347\" face=\"Comic sans MS\">五.  批量和指定删除用户</font>","id":"五-批量和指定删除用户","index":"5","children":[{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">5.1 判断是单选还是多选删除</font>","id":"5-1-判断是单选还是多选删除","index":"5.1"},{"title":"<font color=\"#3CB371\" face=\"Comic sans MS\">5.2 组合SQL语句</font>","id":"5-2-组合SQL语句","index":"5.2"}]},{"title":"<font color=\"#FF6347\" face=\"Comic sans MS\">六. 通过步骤修改用户信息</font>","id":"六-通过步骤修改用户信息","index":"6"},{"title":"<font color=\"#FF6347\" face=\"Comic sans MS\">七. 数据显示乱码终极解决办法</font>","id":"七-数据显示乱码终极解决办法","index":"7"}],"copyright":{"author":"Treecatee","license":"不可转载-非商用-禁止演绎-保持署名 (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow noopener\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","link":"<a href=\"Treecatee.gitgub.io/post/PHP-MySQL/\" title=\"PHP操作MySQL数据库\">Treecatee.gitgub.io/post/PHP-MySQL/</a>","published":"February 24, 2019"}}